#!/usr/bin/env bash

# Run this script to deploy the app to Github Pages.

# Exit if any subcommand fails.
set -ex

echo "Started deploying"

# Generate a tmp folder
DISABLE_WHITELIST=true bundle exec jekyll build

# Move the site generated to a tmp folder
tmpdir=$(mktemp -d /tmp/tmpJordinsSite.XXX)
cp -r _site/* "$tmpdir"/
cd "$tmpdir"

# Add and push to master branch
git init
git add .
git commit -m "Update site [ci]"
git remote add origin git@github.com:jordins/jordins.github.com.git
git push origin master --force

# Restore
cd -
rm -rf "$tmpdir"

echo "Deployed Successfully!"

exit 0
